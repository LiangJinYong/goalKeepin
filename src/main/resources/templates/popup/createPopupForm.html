<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Create Popup Form</title>
<link rel="stylesheet" th:href="@{/css/bootstrap.css}">
<style type="text/css">
.row {
	margin: 15px 0 0 0;
}

#contentArea {
	display: none;
}

</style>
</head>
<body>
	<div class="row">
		<header class="col-md-12">
			<h1 class="brand pull-left">새로운 팝업 생성하기</h1>
		</header>
	</div>
	
	<form method="post" th:action="@{/popup/processPopupCreation}" th:object="${popup}">
		<div class="row">
			<div class="col-md-12">
				<div>
					<label class="col-md-1">이미지</label>
				</div>
				<div class="col-md-11">
					<input type="file" th:field="*{popupImgUrl}" required="required">
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<div class="col-md-1">
					<label>타입</label>
				</div>
				<div class="col-md-11">
					<select th:field="*{popupTypeCd}">
						<option value="PO00">타입</option>
						<option value="PO01">공지사항</option>
						<option value="PO02">챌린지</option>
					</select>
				</div>
			</div>
		</div>
		
		<section id="contentArea">
			<div class="row">
				<div class="col-md-12">
					<div class="col-md-12">
						<label>연결 컨텐츠</label>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-md-11">
					<table id="popupContentTable" class="table table-striped table-hover">
						<thead>
							<tr class="info">
								<th>
								</th>
								<th>
									<h2 class="h4 text-center">NO</h2>
								</th>
								<th>
									<h2 class="h4 text-center">제목</h2>
								</th>
								<th>
									<h2 class="h4 text-center">동록 일자</h2>
								</th>
							</tr>
						</thead>
						<tbody id="contentData"></tbody>
					</table>
				</div>
			</div>
			
			<div class="row text-center">
				<div class="col-md-11">
					<nav aria-label="Page navigation" id="pagingArea">
						<!-- 
						<ul class="pagination">
							<li th:each="i: ${#numbers.sequence(1, paging.totalPages)}" class="page-item" th:classappend="${paging.currentPageNum == i} ? 'active' : ''">
								<a class="page-link" th:href="@{'/user/showUserList/' + *{country} + '/' + ${i}}" th:text="${i}"></a>
							</li>
						</ul>
						 -->
					</nav>
				</div>
			</div>
			
			<div class="row text-center" style="margin-top: 30px;">
				<input type="submit" value="생성하기" class="btn btn-success" />
			</div>
		</section>
	</form>
	
	<script type="text/javascript" th:src="@{/js/jquery.js}"></script>
	<script type="text/javascript">
		$(function() {
			$('#popupTypeCd').change(function() {
				var selectedType = $(this).val();
				
				if('PO01' == selectedType) {
					$('#contentData').empty();
					$('#pagingArea').empty();
					$('#contentArea').show();
					
					var getUrl = '/goalkeepinmanager/popup/getNoticeList/';
					$.getJSON(getUrl + 1,
						function(data) {
							processTableData(data);
							processPagination(data, getUrl);
					});
					
				} else if ('PO02' == selectedType) {
					$('#contentData').empty();
					$('#pagingArea').empty();
					$('#contentArea').show();
					
					var getUrl = '/goalkeepinmanager/popup/getChallengeList/';
					$.getJSON(getUrl + 1,
						function(data) {
							processTableData(data);
							processPagination(data, getUrl);
					});
					
				} else {
					$('#contentArea').hide();
				}
			});
			
			function processTableData(data) {
				$('#contentData').empty();
				var contentList = data.contentList;
				var contentData = '';
				for(var i=0; i < contentList.length; i++) {
					contentData += '<tr class="text-center">';
					contentData += '<td>';
					contentData += '<input type="checkbox">';
					contentData += '</td>';
					contentData += '<td>';
					contentData += contentList[i].contentNo;
					contentData += '</td>';
					contentData += '<td>';
					contentData += contentList[i].contentTitleEn;
					contentData += '</td>';
					contentData += '<td>';
					contentData += contentList[i].contentRegDate;
					contentData += '</td>';
					contentData += '</tr>';
				}
				
				$('#contentData').append(contentData);
			}
			
			function processPagination(data, getUrl) {
				
				var totalPages = data.paging.totalPages;
				var pageData = '<ul class="pagination">';
				for(var i=1; i<=totalPages; i++) {
					pageData += '<li class="page-item';
					if(data.paging.currentPageNum == i) {
						pageData += ' active';
					}
					pageData += '">';
					pageData += '<a style="cursor: pointer" class="page-link">';
					pageData += i;
					pageData += '</a>';
					pageData += '</li>';
				}
				pageData += '</ul>';
				
				$('#pagingArea').append(pageData);
				
				$('.pagination a').click(function() {
					$(this).parent().addClass('active').siblings().removeClass('active');
					$.getJSON(getUrl + $(this).text(),
						function(data) {
							processTableData(data);
						}
					);
				});
				
				$('#popupContentTable tbody tr').css('cursor', 'pointer')
				.click(function() {
					var checkbox = $(this).find('input');
					checkbox.prop('checked', !checkbox.prop('checked'));
				});
				
				$('#userData input').click(function(e) {
					e.stopPropagation();
				});
			}
		});
	</script>
</body>
</html>